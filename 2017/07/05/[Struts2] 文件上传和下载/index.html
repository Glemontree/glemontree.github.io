
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>[Struts2] 文件上传和下载 | Glemontree&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Glemontree">
    

    
    <meta name="description" content="表单准备要想使用HTML表单上传一个或多个文件：

需把HTML表单的enctype属性设置为multipart/form-data
需把HTML表单的method属性设置为post
需添加&amp;lt;input type=&amp;quot;file&amp;quot;&amp;gt;字段

Struts对文件上传的支持在Struts应用程序里，FileUpload拦截器和Commons FileUpload组件可以完成文">
<meta property="og:type" content="article">
<meta property="og:title" content="[Struts2] 文件上传和下载">
<meta property="og:url" content="http://yoursite.com/2017/07/05/[Struts2] 文件上传和下载/index.html">
<meta property="og:site_name" content="Glemontree's blog">
<meta property="og:description" content="表单准备要想使用HTML表单上传一个或多个文件：

需把HTML表单的enctype属性设置为multipart/form-data
需把HTML表单的method属性设置为post
需添加&amp;lt;input type=&amp;quot;file&amp;quot;&amp;gt;字段

Struts对文件上传的支持在Struts应用程序里，FileUpload拦截器和Commons FileUpload组件可以完成文">
<meta property="og:updated_time" content="2017-07-05T11:51:18.088Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[Struts2] 文件上传和下载">
<meta name="twitter:description" content="表单准备要想使用HTML表单上传一个或多个文件：

需把HTML表单的enctype属性设置为multipart/form-data
需把HTML表单的method属性设置为post
需添加&amp;lt;input type=&amp;quot;file&amp;quot;&amp;gt;字段

Struts对文件上传的支持在Struts应用程序里，FileUpload拦截器和Commons FileUpload组件可以完成文">

    
    <link rel="alternative" href="/atom.xml" title="Glemontree&#39;s blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/favicon.ico" alt="Glemontree&#39;s blog" title="Glemontree&#39;s blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Glemontree&#39;s blog">Glemontree&#39;s blog</a></h1>
				<h2 class="blog-motto">day day up!</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页 | Home</a></li>
					
						<li><a href="/archives">归档 | Archives</a></li>
					
						<li><a href="/about">简介 | About</a></li>
					
					<li>
 					
						<form class="search" action="http://zhannei.baidu.com/cse/search" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= null ><input type="text" name="q" size="30" placeholder="Search"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/07/05/[Struts2] 文件上传和下载/" title="[Struts2] 文件上传和下载" itemprop="url">[Struts2] 文件上传和下载</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Glemontree" target="_blank" itemprop="author">Glemontree</a>
		
  <p class="article-time">
    <time datetime="2017-07-05T10:04:38.000Z" itemprop="datePublished"> Published 2017-07-05</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#表单准备"><span class="toc-number">1.</span> <span class="toc-text">表单准备</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Struts对文件上传的支持"><span class="toc-number">2.</span> <span class="toc-text">Struts对文件上传的支持</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Struts文件下载"><span class="toc-number">3.</span> <span class="toc-text">Struts文件下载</span></a></li></ol>
		
		</div>
		
		<h1 id="表单准备"><a href="#表单准备" class="headerlink" title="表单准备"></a>表单准备</h1><p>要想使用HTML表单上传一个或多个文件：</p>
<ul>
<li>需把HTML表单的enctype属性设置为multipart/form-data</li>
<li>需把HTML表单的method属性设置为post</li>
<li>需添加<code>&lt;input type=&quot;file&quot;&gt;</code>字段</li>
</ul>
<h1 id="Struts对文件上传的支持"><a href="#Struts对文件上传的支持" class="headerlink" title="Struts对文件上传的支持"></a>Struts对文件上传的支持</h1><p>在Struts应用程序里，FileUpload拦截器和Commons FileUpload组件可以完成文件的上传。</p>
<p>步骤：</p>
<ul>
<li>在jsp页面的文件上传表单里使用file标签，如果需要一次上传多个标签，就必须使用多个file标签，但他们的名字必须是相同的</li>
<li>在Action中新添加3个和文件上传相关的属性，提供对应的getter和setter方法，这3个属性的名字必须是以下格式：<ul>
<li>[FileName]：File-被上传的文件，例如data</li>
<li>[FileName]ContentType：String-上传文件的文件类型，例如dataContentType</li>
<li>[FileName]FileName：String-上传文件的文件名，例如dataFileName</li>
</ul>
</li>
<li>如果上传多个文件，可以使用List</li>
</ul>
<p>文件上传主要有以下一些知识点：</p>
<ul>
<li><p>Struts2的文件上传实际上使用的是Commons FileUpload组件，所以需要导入：</p>
<ul>
<li>commons-fileupload-1.3.jar</li>
<li>commons-io-2.0.1.jar</li>
</ul>
</li>
<li><p>Struts2进行文件上传需要使用FileUpload拦截器</p>
</li>
<li><p>使用IO流进行文件的上传即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">  <span class="comment">// TODO Auto-generated method stub</span></div><div class="line">  System.out.println(ppt);</div><div class="line">  System.out.println(pptContentType);</div><div class="line">  System.out.println(pptFileName);</div><div class="line">  System.out.println(pptDesc);</div><div class="line"></div><div class="line">  ServletContext servletContext = ServletActionContext.getServletContext();</div><div class="line">  String dir = servletContext.getRealPath(<span class="string">"./"</span> + pptFileName);</div><div class="line">  System.out.println(dir);</div><div class="line">  FileOutputStream out = <span class="keyword">new</span> FileOutputStream(dir);</div><div class="line">  FileInputStream in = <span class="keyword">new</span> FileInputStream(ppt);</div><div class="line">  <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line">  <span class="keyword">int</span> len = <span class="number">0</span>;</div><div class="line">  <span class="keyword">while</span> ((len = in.read(buffer)) != -<span class="number">1</span>) &#123;</div><div class="line">    out.write(buffer, <span class="number">0</span>, len);</div><div class="line">  &#125;</div><div class="line">  out.close();</div><div class="line">  in.close();</div><div class="line">  <span class="keyword">return</span> <span class="keyword">super</span>.execute();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>一次传多个文件</p>
<p>若传递多个文件，则上述的3个属性可以改为List类型，多个文件域的name属性值需要一致。</p>
<ul>
<li><p>upload.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language="java" contentType="text/html; charset=GB18030"</div><div class="line">    pageEncoding="GB18030"%&gt;</div><div class="line">&lt;%@taglib uri="/struts-tags" prefix="s" %&gt;</div><div class="line">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta http-equiv="Content-Type" content="text/html; charset=GB18030"&gt;</div><div class="line">&lt;title&gt;Insert title here&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">	&lt;s:form action="testUpload" method="post" enctype="multipart/form-data"&gt;</div><div class="line">		&lt;s:file name="ppt" label="PPTFile"&gt;&lt;/s:file&gt;</div><div class="line">      	&lt;!--为了使得textField回显不出问题，这里需要使用下标，因为pptDesc是List类型--&gt;</div><div class="line">		&lt;s:textfield name="pptDesc[0]" label="PPTDesc"&gt;&lt;/s:textfield&gt;</div><div class="line">		&lt;s:file name="ppt" label="PPTFile"&gt;&lt;/s:file&gt;</div><div class="line">		&lt;s:textfield name="pptDesc[1]" label="PPTDesc"&gt;&lt;/s:textfield&gt;</div><div class="line">		&lt;s:file name="ppt" label="PPTFile"&gt;&lt;/s:file&gt;</div><div class="line">		&lt;s:textfield name="pptDesc[2]" label="PPTDesc"&gt;&lt;/s:textfield&gt;</div><div class="line">		&lt;s:submit&gt;&lt;/s:submit&gt;</div><div class="line">	&lt;/s:form&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>struts.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></div><div class="line">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</div><div class="line">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- 打开静态方法的限制 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"testUpload"</span> <span class="attr">class</span>=<span class="string">"com.glemontree.struts.UploadAction"</span> <span class="attr">method</span>=<span class="string">"execute"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line">          	<span class="comment">&lt;!-- 回显 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/upload.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>可以对文件的大小、类型、扩展名等进行限制，可以通过配置FileUploadInterceptor拦截器的参数的方式来进行限制，有以下几个参数：</p>
<ul>
<li>maximumSize（上传的单个文件的大小，单位是字节，默认最大值为2M）</li>
<li>allowedTypes（允许的类型，使用逗号分隔）</li>
<li>allowedExtensions（允许的上传文件扩展名，多个使用逗号分隔）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></div><div class="line">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</div><div class="line">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"glemontreestack"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fileUpload.maximumSize"</span>&gt;</span>2000<span class="tag">&lt;/<span class="name">param</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fileUpload.allowedTypes"</span>&gt;</span>text/html,text/xml<span class="tag">&lt;/<span class="name">param</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fileUpload.allowedExtensions"</span>&gt;</span>html,dtd,xml<span class="tag">&lt;/<span class="name">param</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span>			</div><div class="line">			<span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 配置使用这个拦截器栈 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">default-interceptor-ref</span> <span class="attr">name</span>=<span class="string">"glemontreestack"</span>&gt;</span><span class="tag">&lt;/<span class="name">default-interceptor-ref</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"testUpload"</span> <span class="attr">class</span>=<span class="string">"com.glemontree.struts.UploadAction"</span> <span class="attr">method</span>=<span class="string">"execute"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/upload.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Struts文件下载"><a href="#Struts文件下载" class="headerlink" title="Struts文件下载"></a>Struts文件下载</h1><ul>
<li><p>Struts2中使用type=”stream”的result进行下载即可</p>
</li>
<li><p>具体使用细节请查看Struts2文档</p>
</li>
<li><p>可以为stream的result设定如下参数：</p>
<ul>
<li><strong>contentType</strong> - the stream mime-type as sent to the web browser (default = <code>text/plain</code>).</li>
</ul>
</li>
</ul>
<ul>
<li><strong>contentLength</strong> - the stream length in bytes (the browser displays a progress bar).</li>
</ul>
<ul>
<li><strong>contentDisposition</strong> - the content disposition header value for specifing the file name (default = <code>inline</code>, values are typically <em>attachment;filename=”document.pdf”</em>.(设定Content-Disposition响应头，该响应头指定是一个文件下载类型，一般取值为attachment;filename=”document.pdf”)</li>
</ul>
<ul>
<li><strong>inputName</strong> - the name of the InputStream property from the chained action (default = <code>inputStream</code>).(指定文件输入流的getter定义的那个属性的名字，默认为inputStream)</li>
</ul>
<ul>
<li><strong>bufferSize</strong> - the size of the buffer to copy from input to output (default = <code>1024</code>).</li>
</ul>
<ul>
<li><strong>allowCaching</strong> if set to ‘false’ it will set the headers ‘Pragma’ and ‘Cache-Control’ to ‘no-cahce’, and prevent client from caching the content. (default = <code>true</code>)</li>
<li><p><strong>contentCharSet</strong> if set to a string, ‘;charset=value’ will be added to the content-type header, where value is the string set. If set to an expression, the result of evaluating the expression will be used. If not set, then no charset will be set on the header</p>
<p>前面三个成员的值可以通过在Action中动态指定，后面三个的值可以在struts.xml文件中静态指定。</p>
</li>
</ul>
<ul>
<li><p>以上参数可以在Action中以getter方法的方式提供，动态指定参数的值</p>
</li>
<li><p>举例</p>
<ul>
<li><p>struts.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"testDownload"</span> <span class="attr">class</span>=<span class="string">"com.glemontree.struts.DownLoadAction"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"stream"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"bufferSize"</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>DownloadAction.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.glemontree.struts;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.FileInputStream;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownLoadAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * </div><div class="line">	 */</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> String contentType;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">long</span> contentLength;</div><div class="line">	<span class="keyword">private</span> String contentDisposition;</div><div class="line">	<span class="keyword">private</span> InputStream inputStream;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getContentType</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> contentType;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getContentLength</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> contentLength;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getContentDisposition</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> contentDisposition;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> InputStream <span class="title">getInputStream</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> inputStream;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		<span class="comment">// TODO Auto-generated method stub</span></div><div class="line">		<span class="comment">// 确定各个成员变量的值</span></div><div class="line">		contentType = <span class="string">"text/html"</span>;</div><div class="line">		contentDisposition = <span class="string">"attachment;filename=hidden.html"</span>;</div><div class="line">		ServletContext servletContext = ServletActionContext.getServletContext();</div><div class="line">		String fileName = servletContext.getRealPath(<span class="string">"/hidden.html"</span>);</div><div class="line">		inputStream = <span class="keyword">new</span> FileInputStream(fileName);</div><div class="line">		contentLength = inputStream.available();</div><div class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.execute();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
</li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Struts2/">Struts2</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Struts2-文件上传-文件下载/">Struts2, 文件上传, 文件下载</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2017/07/05/[Struts2] 文件上传和下载/" data-title="[Struts2] 文件上传和下载 | Glemontree&#39;s blog" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2017/07/05/[Struts2] ModelDriven和Preparable拦截器/" title="[Struts2] ModelDriven和Preparable拦截器">
  <strong>上一篇：</strong><br/>
  <span>
  [Struts2] ModelDriven和Preparable拦截器</span>
</a>
</div>


<div class="next">
<a href="/2017/07/04/[Struts2] OGNL siterator标签的使用/"  title="[Struts2] OGNL s:iterator标签的使用">
 <strong>下一篇：</strong><br/> 
 <span>[Struts2] OGNL s:iterator标签的使用
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2017/07/05/[Struts2] 文件上传和下载/" data-title="[Struts2] 文件上传和下载" data-url="http://yoursite.com/2017/07/05/[Struts2] 文件上传和下载/"></div>
</section>



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#表单准备"><span class="toc-number">1.</span> <span class="toc-text">表单准备</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Struts对文件上传的支持"><span class="toc-number">2.</span> <span class="toc-text">Struts对文件上传的支持</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Struts文件下载"><span class="toc-number">3.</span> <span class="toc-text">Struts文件下载</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="glemontree" data-theme="medium"></div>
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/Boost/" title="Boost">Boost<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/C/" title="C++">C++<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/CMake/" title="CMake">CMake<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/DB/" title="DB">DB<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Hexo/" title="Hexo">Hexo<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Qt/" title="Qt">Qt<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Servlet/" title="Servlet">Servlet<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Spring/" title="Spring">Spring<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Struts2/" title="Struts2">Struts2<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/TCP-IP/" title="TCP/IP">TCP/IP<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Windows核心编程/" title="Windows核心编程">Windows核心编程<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/android/" title="android">android<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/html/" title="html">html<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/多线程/" title="多线程">多线程<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/编程规范/" title="编程规范">编程规范<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/网络编程/" title="网络编程">网络编程<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/设计模式/" title="设计模式">设计模式<sup>2</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/C/" title="C++">C++<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/DB/" title="DB">DB<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/C-boost/" title="C++ boost">C++ boost<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Struts2-OGNL/" title="Struts2, OGNL">Struts2, OGNL<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Spring-注解-Bean/" title="Spring, 注解, Bean">Spring, 注解, Bean<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/C-VS/" title="C++, VS">C++, VS<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/C-bind-回调/" title="C++, bind, 回调">C++, bind, 回调<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/C-assert/" title="C++, assert">C++, assert<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/C-继承-同名成员变量/" title="C++, 继承, 同名成员变量">C++, 继承, 同名成员变量<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/MySQL-UPDATE/" title="MySQL UPDATE">MySQL UPDATE<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/CMake/" title="CMake">CMake<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/CMake-VS/" title="CMake, VS">CMake, VS<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/C-Boost/" title="C++, Boost">C++, Boost<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/通配符/" title="通配符">通配符<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Java-反射-无参构造函数/" title="Java, 反射, 无参构造函数">Java, 反射, 无参构造函数<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/前置/" title="前置++">前置++<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/后置/" title="后置++">后置++<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo-主题/" title="Hexo, 主题">Hexo, 主题<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/INSERT/" title="INSERT">INSERT<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Linux-eventfd/" title="Linux, eventfd">Linux, eventfd<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://github.com/glemontree" target="_blank" title="GitHub">GitHub</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.csdn.net/u010216743" target="_blank" title="CSDN">CSDN</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello World. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/glemontree" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:gtp0521@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="Glemontree">Glemontree</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"glemontree"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<script>
var option = {
  engineKey: 'null'
};
(function(w,d,t,u,n,s,e){
  s = d.createElement(t);
  s.src = u;
  s.async = 1;
  w[n] = function(r){
    w[n].opts = r;
  };
  e = d.getElementsByTagName(t)[0];
  e.parentNode.insertBefore(s, e);
})(window,document,'script','//tinysou-cdn.b0.upaiyun.com/ts.js','_ts');
_ts(option);
</script>

<!-- Tiny_search End -->

  </body>
</html>
