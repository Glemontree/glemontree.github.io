<!DOCTYPE html>
<html>
<head>
    

    
<!-- Tencent Speed -->
<script>var _speedMark = new Date()</script>
<!-- End Tencent Speed -->
<!-- Tencent Analysis -->
<script async src="//tajs.qq.com/stats?sId=65601540"></script>
<!-- End Tencent Analysis -->


    



    <meta charset="utf-8">
    
    
    
    
    <title>[Struts2] 文件上传和下载 | Glemontree&#39;s blog | day day up!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Struts2, 文件上传, 文件下载">
    <meta name="description" content="表单准备要想使用HTML表单上传一个或多个文件：

需把HTML表单的enctype属性设置为multipart/form-data
需把HTML表单的method属性设置为post
需添加&amp;lt;input type=&amp;quot;file&amp;quot;&amp;gt;字段

Struts对文件上传的支持在Struts应用程序里，FileUpload拦截器和Commons FileUpload组件可以完成文">
<meta property="og:type" content="article">
<meta property="og:title" content="[Struts2] 文件上传和下载">
<meta property="og:url" content="https://glemontree.github.io/2017/07/05/[Struts2] 文件上传和下载/index.html">
<meta property="og:site_name" content="Glemontree's blog">
<meta property="og:description" content="表单准备要想使用HTML表单上传一个或多个文件：

需把HTML表单的enctype属性设置为multipart/form-data
需把HTML表单的method属性设置为post
需添加&amp;lt;input type=&amp;quot;file&amp;quot;&amp;gt;字段

Struts对文件上传的支持在Struts应用程序里，FileUpload拦截器和Commons FileUpload组件可以完成文">
<meta property="og:updated_time" content="2017-07-05T11:51:18.088Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[Struts2] 文件上传和下载">
<meta name="twitter:description" content="表单准备要想使用HTML表单上传一个或多个文件：

需把HTML表单的enctype属性设置为multipart/form-data
需把HTML表单的method属性设置为post
需添加&amp;lt;input type=&amp;quot;file&amp;quot;&amp;gt;字段

Struts对文件上传的支持在Struts应用程序里，FileUpload拦截器和Commons FileUpload组件可以完成文">
    
        <link rel="alternate" type="application/atom+xml" title="Glemontree&#39;s blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Glemontree</h5>
          <a href="mailto:glemontree@163.com" title="glemontree@163.com" class="mail">glemontree@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                homepage
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/Glemontree" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/glemontree" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">[Struts2] 文件上传和下载</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">[Struts2] 文件上传和下载</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-07-05T10:04:38.000Z" itemprop="datePublished" class="page-time">
  2017-07-05
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Struts2/">Struts2</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#表单准备"><span class="post-toc-number">1.</span> <span class="post-toc-text">表单准备</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Struts对文件上传的支持"><span class="post-toc-number">2.</span> <span class="post-toc-text">Struts对文件上传的支持</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Struts文件下载"><span class="post-toc-number">3.</span> <span class="post-toc-text">Struts文件下载</span></a></li></ol>
        </nav>
    </aside>


<article id="post-[Struts2] 文件上传和下载"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">[Struts2] 文件上传和下载</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-07-05 18:04:38" datetime="2017-07-05T10:04:38.000Z"  itemprop="datePublished">2017-07-05</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Struts2/">Struts2</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="表单准备"><a href="#表单准备" class="headerlink" title="表单准备"></a>表单准备</h1><p>要想使用HTML表单上传一个或多个文件：</p>
<ul>
<li>需把HTML表单的enctype属性设置为multipart/form-data</li>
<li>需把HTML表单的method属性设置为post</li>
<li>需添加<code>&lt;input type=&quot;file&quot;&gt;</code>字段</li>
</ul>
<h1 id="Struts对文件上传的支持"><a href="#Struts对文件上传的支持" class="headerlink" title="Struts对文件上传的支持"></a>Struts对文件上传的支持</h1><p>在Struts应用程序里，FileUpload拦截器和Commons FileUpload组件可以完成文件的上传。</p>
<p>步骤：</p>
<ul>
<li>在jsp页面的文件上传表单里使用file标签，如果需要一次上传多个标签，就必须使用多个file标签，但他们的名字必须是相同的</li>
<li>在Action中新添加3个和文件上传相关的属性，提供对应的getter和setter方法，这3个属性的名字必须是以下格式：<ul>
<li>[FileName]：File-被上传的文件，例如data</li>
<li>[FileName]ContentType：String-上传文件的文件类型，例如dataContentType</li>
<li>[FileName]FileName：String-上传文件的文件名，例如dataFileName</li>
</ul>
</li>
<li>如果上传多个文件，可以使用List</li>
</ul>
<p>文件上传主要有以下一些知识点：</p>
<ul>
<li><p>Struts2的文件上传实际上使用的是Commons FileUpload组件，所以需要导入：</p>
<ul>
<li>commons-fileupload-1.3.jar</li>
<li>commons-io-2.0.1.jar</li>
</ul>
</li>
<li><p>Struts2进行文件上传需要使用FileUpload拦截器</p>
</li>
<li><p>使用IO流进行文件的上传即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">  <span class="comment">// TODO Auto-generated method stub</span></div><div class="line">  System.out.println(ppt);</div><div class="line">  System.out.println(pptContentType);</div><div class="line">  System.out.println(pptFileName);</div><div class="line">  System.out.println(pptDesc);</div><div class="line"></div><div class="line">  ServletContext servletContext = ServletActionContext.getServletContext();</div><div class="line">  String dir = servletContext.getRealPath(<span class="string">"./"</span> + pptFileName);</div><div class="line">  System.out.println(dir);</div><div class="line">  FileOutputStream out = <span class="keyword">new</span> FileOutputStream(dir);</div><div class="line">  FileInputStream in = <span class="keyword">new</span> FileInputStream(ppt);</div><div class="line">  <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line">  <span class="keyword">int</span> len = <span class="number">0</span>;</div><div class="line">  <span class="keyword">while</span> ((len = in.read(buffer)) != -<span class="number">1</span>) &#123;</div><div class="line">    out.write(buffer, <span class="number">0</span>, len);</div><div class="line">  &#125;</div><div class="line">  out.close();</div><div class="line">  in.close();</div><div class="line">  <span class="keyword">return</span> <span class="keyword">super</span>.execute();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>一次传多个文件</p>
<p>若传递多个文件，则上述的3个属性可以改为List类型，多个文件域的name属性值需要一致。</p>
<ul>
<li><p>upload.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language="java" contentType="text/html; charset=GB18030"</div><div class="line">    pageEncoding="GB18030"%&gt;</div><div class="line">&lt;%@taglib uri="/struts-tags" prefix="s" %&gt;</div><div class="line">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta http-equiv="Content-Type" content="text/html; charset=GB18030"&gt;</div><div class="line">&lt;title&gt;Insert title here&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">	&lt;s:form action="testUpload" method="post" enctype="multipart/form-data"&gt;</div><div class="line">		&lt;s:file name="ppt" label="PPTFile"&gt;&lt;/s:file&gt;</div><div class="line">      	&lt;!--为了使得textField回显不出问题，这里需要使用下标，因为pptDesc是List类型--&gt;</div><div class="line">		&lt;s:textfield name="pptDesc[0]" label="PPTDesc"&gt;&lt;/s:textfield&gt;</div><div class="line">		&lt;s:file name="ppt" label="PPTFile"&gt;&lt;/s:file&gt;</div><div class="line">		&lt;s:textfield name="pptDesc[1]" label="PPTDesc"&gt;&lt;/s:textfield&gt;</div><div class="line">		&lt;s:file name="ppt" label="PPTFile"&gt;&lt;/s:file&gt;</div><div class="line">		&lt;s:textfield name="pptDesc[2]" label="PPTDesc"&gt;&lt;/s:textfield&gt;</div><div class="line">		&lt;s:submit&gt;&lt;/s:submit&gt;</div><div class="line">	&lt;/s:form&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>struts.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></div><div class="line">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</div><div class="line">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- 打开静态方法的限制 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"testUpload"</span> <span class="attr">class</span>=<span class="string">"com.glemontree.struts.UploadAction"</span> <span class="attr">method</span>=<span class="string">"execute"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line">          	<span class="comment">&lt;!-- 回显 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/upload.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>可以对文件的大小、类型、扩展名等进行限制，可以通过配置FileUploadInterceptor拦截器的参数的方式来进行限制，有以下几个参数：</p>
<ul>
<li>maximumSize（上传的单个文件的大小，单位是字节，默认最大值为2M）</li>
<li>allowedTypes（允许的类型，使用逗号分隔）</li>
<li>allowedExtensions（允许的上传文件扩展名，多个使用逗号分隔）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></div><div class="line">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</div><div class="line">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"glemontreestack"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fileUpload.maximumSize"</span>&gt;</span>2000<span class="tag">&lt;/<span class="name">param</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fileUpload.allowedTypes"</span>&gt;</span>text/html,text/xml<span class="tag">&lt;/<span class="name">param</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fileUpload.allowedExtensions"</span>&gt;</span>html,dtd,xml<span class="tag">&lt;/<span class="name">param</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span>			</div><div class="line">			<span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 配置使用这个拦截器栈 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">default-interceptor-ref</span> <span class="attr">name</span>=<span class="string">"glemontreestack"</span>&gt;</span><span class="tag">&lt;/<span class="name">default-interceptor-ref</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"testUpload"</span> <span class="attr">class</span>=<span class="string">"com.glemontree.struts.UploadAction"</span> <span class="attr">method</span>=<span class="string">"execute"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">result</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>/upload.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Struts文件下载"><a href="#Struts文件下载" class="headerlink" title="Struts文件下载"></a>Struts文件下载</h1><ul>
<li><p>Struts2中使用type=”stream”的result进行下载即可</p>
</li>
<li><p>具体使用细节请查看Struts2文档</p>
</li>
<li><p>可以为stream的result设定如下参数：</p>
<ul>
<li><strong>contentType</strong> - the stream mime-type as sent to the web browser (default = <code>text/plain</code>).</li>
</ul>
</li>
</ul>
<ul>
<li><strong>contentLength</strong> - the stream length in bytes (the browser displays a progress bar).</li>
</ul>
<ul>
<li><strong>contentDisposition</strong> - the content disposition header value for specifing the file name (default = <code>inline</code>, values are typically <em>attachment;filename=”document.pdf”</em>.(设定Content-Disposition响应头，该响应头指定是一个文件下载类型，一般取值为attachment;filename=”document.pdf”)</li>
</ul>
<ul>
<li><strong>inputName</strong> - the name of the InputStream property from the chained action (default = <code>inputStream</code>).(指定文件输入流的getter定义的那个属性的名字，默认为inputStream)</li>
</ul>
<ul>
<li><strong>bufferSize</strong> - the size of the buffer to copy from input to output (default = <code>1024</code>).</li>
</ul>
<ul>
<li><strong>allowCaching</strong> if set to ‘false’ it will set the headers ‘Pragma’ and ‘Cache-Control’ to ‘no-cahce’, and prevent client from caching the content. (default = <code>true</code>)</li>
<li><p><strong>contentCharSet</strong> if set to a string, ‘;charset=value’ will be added to the content-type header, where value is the string set. If set to an expression, the result of evaluating the expression will be used. If not set, then no charset will be set on the header</p>
<p>前面三个成员的值可以通过在Action中动态指定，后面三个的值可以在struts.xml文件中静态指定。</p>
</li>
</ul>
<ul>
<li><p>以上参数可以在Action中以getter方法的方式提供，动态指定参数的值</p>
</li>
<li><p>举例</p>
<ul>
<li><p>struts.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"testDownload"</span> <span class="attr">class</span>=<span class="string">"com.glemontree.struts.DownLoadAction"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"stream"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"bufferSize"</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>DownloadAction.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.glemontree.struts;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.FileInputStream;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownLoadAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * </div><div class="line">	 */</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> String contentType;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">long</span> contentLength;</div><div class="line">	<span class="keyword">private</span> String contentDisposition;</div><div class="line">	<span class="keyword">private</span> InputStream inputStream;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getContentType</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> contentType;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getContentLength</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> contentLength;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getContentDisposition</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> contentDisposition;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> InputStream <span class="title">getInputStream</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> inputStream;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		<span class="comment">// TODO Auto-generated method stub</span></div><div class="line">		<span class="comment">// 确定各个成员变量的值</span></div><div class="line">		contentType = <span class="string">"text/html"</span>;</div><div class="line">		contentDisposition = <span class="string">"attachment;filename=hidden.html"</span>;</div><div class="line">		ServletContext servletContext = ServletActionContext.getServletContext();</div><div class="line">		String fileName = servletContext.getRealPath(<span class="string">"/hidden.html"</span>);</div><div class="line">		inputStream = <span class="keyword">new</span> FileInputStream(fileName);</div><div class="line">		contentLength = inputStream.available();</div><div class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.execute();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
</li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2017-07-05T11:51:18.088Z" itemprop="dateUpdated">2017-07-05 19:51:18</time>
</span><br>


        
        <a href="/2017/07/05/[Struts2] 文件上传和下载/" target="_blank" rel="external">https://glemontree.github.io/2017/07/05/[Struts2] 文件上传和下载/</a>
        
    </div>
    
    <footer>
        <a href="https://glemontree.github.io">
            <img src="/img/avatar.jpg" alt="Glemontree">
            Glemontree
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Struts2-文件上传-文件下载/">Struts2, 文件上传, 文件下载</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://glemontree.github.io/2017/07/05/[Struts2] 文件上传和下载/&title=《[Struts2] 文件上传和下载》 — Glemontree's blog&pic=https://glemontree.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://glemontree.github.io/2017/07/05/[Struts2] 文件上传和下载/&title=《[Struts2] 文件上传和下载》 — Glemontree's blog&source=记录我学习的每一步" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://glemontree.github.io/2017/07/05/[Struts2] 文件上传和下载/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《[Struts2] 文件上传和下载》 — Glemontree's blog&url=https://glemontree.github.io/2017/07/05/[Struts2] 文件上传和下载/&via=https://glemontree.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://glemontree.github.io/2017/07/05/[Struts2] 文件上传和下载/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2017/07/05/[Struts2] ModelDriven和Preparable拦截器/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">[Struts2] ModelDriven和Preparable拦截器</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2017/07/04/[Struts2] OGNL siterator标签的使用/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">[Struts2] OGNL s:iterator标签的使用</h4>
      </a>
    </div>
  
</nav>



    


<section class="comments" id="comments">
    <div id="disqus_thread"></div>
    <script>
    var disqus_shortname = 'true';
    lazyScripts.push('//' + disqus_shortname + '.disqus.com/embed.js')
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>
















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢打赏
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Glemontree &copy; 2017 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://glemontree.github.io/2017/07/05/[Struts2] 文件上传和下载/&title=《[Struts2] 文件上传和下载》 — Glemontree's blog&pic=https://glemontree.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://glemontree.github.io/2017/07/05/[Struts2] 文件上传和下载/&title=《[Struts2] 文件上传和下载》 — Glemontree's blog&source=记录我学习的每一步" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://glemontree.github.io/2017/07/05/[Struts2] 文件上传和下载/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《[Struts2] 文件上传和下载》 — Glemontree's blog&url=https://glemontree.github.io/2017/07/05/[Struts2] 文件上传和下载/&via=https://glemontree.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://glemontree.github.io/2017/07/05/[Struts2] 文件上传和下载/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACuUlEQVR42u3aQW4bMRAEQP3/0w7gU4JYcvcMKftQexIW0i6LBjh0cx6P+Pr4vP7//Ped5Hosrv0T8PDw8E7xkgEln589s33C6+nLx4yHh4d3m7cpBs9emVBnd5Ix4+Hh4f0GXv7QZ9/Pt8XtBOHh4eH9Tt6p7fXrbXE7Bjw8PLyf4iVhRD6U18/fF4MrWQseHh7e0XOoTZG48flN53t4eHh45al62xCQL/3J9rotBl88AQ8PD+8CLx9WWypmG/Q8kigKBh4eHt5RXruI5zFEgk8mbvYn+afu4eHh4V3g5f/8r+rPG0vLI0+C8fDw8Ba8tvVqT01atRJkEePi4eHhHeLlzQF55LoZbruV/6Yw4OHh4V3gnRpiO+i2OaB+Dh4eHt4FXhs0JPjZ0domyBgmH3h4eHij77etTnk8sYk8jm3i8fDw8C7wkoOu2Z02PshLS/5bPDw8vHu8fDmeAdr7yVTOmrHw8PDwTvH2L2iDjLzMJBP6zTjx8PDwrvHaCGB2cNVOyiywwMPDw3sPLykMeZSQL+Kz3xbjx8PDw7vGazGbI7G2ISB/+xd38PDw8I7yZkdH7YLegvNA5JuoAg8PD+8yLz+8b+PatoXrWLHBw8PDu8ZbtS7Fi3sey+aNBXXKgoeHh7fmJXFAHj3kU5ZsjvMVvkDi4eHhHeXlr8wxySJeRwxnSwIeHh7eohhsXv+a2haPWdPA09/i4eHhXebtI93Zsp6XhLak4eHh4Z3lfZRXDm4P2/LWrmJS8PDw8C7w2gOt/H6+Oc4PyQ43FuDh4eEtePminGyU25AiQc7CDjw8PLzbvHbJ3jcK5PfzMDdqGsDDw8N7Oy+JCWahRrsRLw7A8PDw8H6Ilx/274/KZsUDDw8P7528zeHTrH1qQyq23Xh4eHgXeO0BWB7yttPRYo6x8fDw8NJv/gESJeQpQ84PkwAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


lazyScripts.push('//s95.cnzz.com/z_stat.php?id=1273392949&web_id=1273392949')

</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
